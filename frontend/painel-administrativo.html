<!DOCTYPE html>
<html lang="pt-BR">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0"
    />
    <title>Painel Administrativo</title>
    <link
      rel="icon"
      href="assets/logo-labem.png"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
      rel="stylesheet"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Segoe UI', system-ui, sans-serif;
      }

      body {
        background-color: var(--primary-color);
        line-height: 1.6;
        background-color: #146677;
      }

      .navbar {
        font-size: 1.4em;
        color: #146677 !important;
        padding: 2rem;
        white-space: nowrap;
        font-weight: 500;
        background: white;
        margin-bottom: 2rem;
        color: var(--primary-color);
        display: flex;
        justify-content: space-between;
        align-items: center;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }

      .nav-brand {
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }

      .logo {
        width: 40px;
        height: 40px;
      }
      .logo {
        width: 40px;
        height: 40px;
      }

      .admin-icon {
        margin-top: 3px !important;
        color: var(--primary-color);
        font-size: 1.1rem;
        transition: color 0.3s ease;
      }

      .update-box {
        border: 1px solid #ddd;
        border-radius: 10px;
        padding: 10px;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .update-box i {
        font-size: 2rem;
        color: #007bff;
      }

      .update-text {
        flex: 1;
        color: white;
      }

      .btn-custom {
        margin: 5px;
      }

      .admin-panel {
        background-color: #f8f9fa;
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 30px;
      }

      .admin-panel img {
        max-width: 100%;
        border-radius: 10px;
        margin-top: 20px;
      }

      img {
        width: 100%;
      }
      .footer {
        background: transparent;
        color: #f2f2f2;
        padding: 20px 15px;
        font-size: 14px;
        text-align: center;
      }

      .footer-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 10px;
      }

      .footer-info p,
      .footer-dev p {
        margin: 5px 0;
        line-height: 1.4;
      }

      .footer-dev a {
        color: #b3e0ff;
        margin: 0 5px;
        font-size: 18px;
        transition: color 0.3s ease;
      }

      .footer-dev a:hover {
        color: #6db3ff;
      }

      .hero {
        text-align: center;
        padding: 3rem 1rem;
      }

      .hero-title {
        font-size: 2rem;
        margin-bottom: 1rem;
        color: white;
      }

      .highlight {
        color: var(--accent-color);
      }

      .hero-subtitle {
        font-size: 1.2rem;
        color: #7f8c8d !important;
      }
      .linkzinho {
        text-decoration: none;
        font-size: 16px;
      }
      .text-center {
        color: white;
      }
      /* Estilos para a se√ß√£o de mensagens do banco de dados (mobile first) */
      #mensagens-banco {
        background: #fff;
        border-radius: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.07);
        padding: 1.5rem 1rem;
        margin: 2rem auto;
        max-width: 600px;
        width: 100%;
        display: flex;
        flex-direction: column;
        gap: 1.2rem;
      }
      .mensagem-item {
        border-left: 4px solid #146677;
        background: #f7fafd;
        border-radius: 8px;
        padding: 1rem 1.2rem;
        box-shadow: 0 1px 4px rgba(20, 102, 119, 0.04);
        display: flex;
        flex-direction: column;
        gap: 0.3rem;
        word-break: break-word;
      }
      .mensagem-item strong {
        color: #146677;
        font-size: 1.05em;
      }
      .mensagem-item .mensagem-email {
        color: #555;
        font-size: 0.98em;
        margin-bottom: 0.2em;
      }
      .mensagem-item .mensagem-assunto {
        color: #0a3d4d;
        font-weight: 600;
        margin-bottom: 0.2em;
      }
      .mensagem-item .mensagem-texto {
        color: #222;
        font-size: 1em;
      }
      @media (min-width: 700px) {
        #mensagens-banco {
          max-width: 900px;
          padding: 2.5rem 2rem;
        }
        .mensagem-item {
          flex-direction: row;
          align-items: flex-start;
          gap: 2rem;
        }
        .mensagem-item .mensagem-dados {
          min-width: 220px;
        }
        .mensagem-item .mensagem-texto {
          flex: 1;
        }
      }
    </style>
  </head>
  <body>
    <nav class="navbar">
      <div class="nav-brand">
        <img
          src="assets/logo-labem.png"
          alt="Logo Ligantes"
          class="logo"
        />
        <span>Ligantes LABEM</span>
        <a
          href="painel-do-ligante.html"
          class="admin-icon"
          title="Painel Administrativo"
        >
          <i class="fa-regular fa-user"></i
        ></a>
      </div>
    </nav>
    <header class="hero">
      <h1 class="hero-title">
        Bem-vindo ao Painel Administrativo!<span class="highlight">üéì</span>
      </h1>
      <p class="hero-subtitle">
        Aqui voc√™ pode adicionar, editar ou deletar os t√≥picos da se√ß√£o "√öltimas
        Atualiza√ß√µes" APENAS AUTORIZADOS!
      </p>
    </header>
    <section
      id="eventos1"
      class="atualizacoes"
    >
      <div class="container">
        <div class="admin-panel">
          <img
            src="assets/painel-img.png"
            alt="Painel de Atualiza√ß√µes"
          />

          <form
            id="form-topicos"
            class="mt-4"
          >
            <div class="mb-3">
              <label
                for="icone"
                class="form-label"
                >√çcone (classe do Font Awesome):</label
              >
              <a
                class="linkzinho"
                href="https://fontawesome.com/icons"
                >Biblioteca de √çcones</a
              >
              <input
                type="text"
                class="form-control"
                id="icone"
                placeholder="Ex: fa-calendar-check"
              />
            </div>
            <div class="mb-3">
              <label
                for="titulo"
                class="form-label"
                >T√≠tulo:</label
              >
              <input
                type="text"
                class="form-control"
                id="titulo"
                placeholder="Ex: Encontro Te√≥rico"
              />
            </div>
            <div class="mb-3">
              <label
                for="paragrafo"
                class="form-label"
                >Par√°grafo:</label
              >
              <textarea
                class="form-control"
                id="paragrafo"
                rows="3"
                placeholder="Ex: O primeiro encontro te√≥rico..."
              ></textarea>
            </div>
            <button
              type="submit"
              class="btn btn-primary btn-custom"
            >
              Adicionar T√≥pico
            </button>
            <button
              type="button"
              class="btn btn-success btn-custom"
              disabled
            >
              Finalizar Altera√ß√£o
            </button>
          </form>
        </div>

        <h2 class="text-center">√öltimas Atualiza√ß√µes</h2>
        <div id="topicos-container">
          <div
            class="update-box"
            id="topico-1"
          >
            <i class="fa-solid fa-calendar-check"></i>
            <div class="update-text">
              <h3>Encontro Te√≥rico</h3>
              <p>
                O primeiro encontro te√≥rico da liga ser√° realizado no dia 15/03
                e abordar√° temas essenciais como sistema tegumentar, barreira
                cut√¢nea e gerenciamento de pele.
              </p>
            </div>
            <button
              type="button"
              class="btn btn-danger btn-custom"
              onclick="confirmarDelecao('topico-1')"
            >
              Deletar T√≥pico 1
            </button>
          </div>
          <div
            class="update-box"
            id="topico-2"
          >
            <i class="fa-solid fa-users"></i>
            <div class="update-text">
              <h3>Encontro Pr√°tico</h3>
              <p>
                A pr√°tica de limpeza de pele ser√° conduzida pelo Msc. Weslley da
                Fran√ßa, esteticista com mais de 15 anos de experi√™ncia e atua√ß√£o
                internacional.
              </p>
            </div>
            <button
              type="button"
              class="btn btn-danger btn-custom"
              onclick="confirmarDelecao('topico-2')"
            >
              Deletar T√≥pico 2
            </button>
          </div>
        </div>
      </div>
    </section>

    <!-- Section para exibir mensagens do banco de dados (formul√°rio de contato) -->
    <section id="mensagens-banco">
      <!-- Mensagens ser√£o carregadas via JS -->
    </section>

    <footer class="footer">
      <div class="footer-container">
        <div class="footer-info">
          <p>UNISUL - Universidade do Sul de Santa Catarina</p>
          <p>&copy; 2025 Labem. Todos os direitos reservados.</p>
        </div>
        <div class="footer-dev">
          <p>
            Desenvolvido por
            <a
              href="https://github.com/mmyersbyte"
              target="_blank"
              ><i class="fab fa-github"></i
            ></a>
            <a
              href="https://www.instagram.com/pedrovicstro"
              target="_blank"
              ><i class="fab fa-instagram"></i
            ></a>
            <a
              href="https://portfolio-dev-six-pied.vercel.app/"
              target="_blank"
              ><i class="fas fa-rocket"></i
            ></a>
          </p>
        </div>
      </div>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.min.js"></script>
    <script>
      // URL base da API de atualiza√ß√µes
      const API_URL = 'https://labem.onrender.com/api/updates';

      // Elementos do DOM
      const form = document.getElementById('form-topicos');
      const iconeInput = document.getElementById('icone');
      const tituloInput = document.getElementById('titulo');
      const paragrafoInput = document.getElementById('paragrafo');
      const topicosContainer = document.getElementById('topicos-container');

      // Carrega as atualiza√ß√µes ao abrir o painel
      window.addEventListener('DOMContentLoaded', carregarAtualizacoes);

      // Fun√ß√£o para renderizar as atualiza√ß√µes
      async function carregarAtualizacoes() {
        topicosContainer.innerHTML = '<p style="color:white">Carregando...</p>';
        try {
          const res = await fetch(API_URL);
          const data = await res.json();
          if (data.success) {
            if (data.updates.length === 0) {
              topicosContainer.innerHTML =
                '<p style="color:white">Nenhuma atualiza√ß√£o cadastrada.</p>';
              return;
            }
            topicosContainer.innerHTML = '';
            data.updates.forEach((update) => {
              topicosContainer.innerHTML += criarHTMLUpdate(update);
            });
          } else {
            topicosContainer.innerHTML =
              '<p style="color:red">Erro ao carregar atualiza√ß√µes.</p>';
          }
        } catch (err) {
          topicosContainer.innerHTML =
            '<p style="color:red">Erro de conex√£o com o servidor.</p>';
        }
      }

      // Fun√ß√£o para criar o HTML de uma atualiza√ß√£o
      function criarHTMLUpdate(update) {
        return `
          <div class="update-box" data-id="${update._id}">
            <i class="fa-solid ${update.icone}"></i>
            <div class="update-text">
              <h3 contenteditable="true" onblur="salvarEdicao('${update._id}', 'titulo', this.innerText)">${update.titulo}</h3>
              <p contenteditable="true" onblur="salvarEdicao('${update._id}', 'paragrafo', this.innerText)">${update.paragrafo}</p>
            </div>
            <button type="button" class="btn btn-danger btn-custom" onclick="deletarUpdate('${update._id}')">Deletar</button>
          </div>
        `;
      }

      // Adiciona novo t√≥pico (atualiza√ß√£o)
      form.addEventListener('submit', async function (e) {
        e.preventDefault();
        const icone = iconeInput.value.trim();
        const titulo = tituloInput.value.trim();
        const paragrafo = paragrafoInput.value.trim();
        if (!icone || !titulo || !paragrafo) {
          alert('Preencha todos os campos!');
          return;
        }
        try {
          const res = await fetch(API_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            credentials: 'include', // importante para cookies de sess√£o
            body: JSON.stringify({ icone, titulo, paragrafo }),
          });
          const data = await res.json();
          if (data.success) {
            form.reset();
            carregarAtualizacoes();
            alert('T√≥pico adicionado com sucesso!');
          } else {
            alert(data.message || 'Erro ao adicionar t√≥pico.');
          }
        } catch (err) {
          alert('Erro de conex√£o.');
        }
      });

      // Fun√ß√£o global para deletar atualiza√ß√£o
      window.deletarUpdate = async function (id) {
        if (!confirm('Tem certeza que deseja deletar?')) return;
        try {
          const res = await fetch(`${API_URL}/${id}`, {
            method: 'DELETE',
            credentials: 'include',
          });
          const data = await res.json();
          if (data.success) {
            carregarAtualizacoes();
            alert('T√≥pico deletado com sucesso!');
          } else {
            alert(data.message || 'Erro ao deletar t√≥pico.');
          }
        } catch (err) {
          alert('Erro de conex√£o.');
        }
      };

      // Fun√ß√£o global para salvar edi√ß√£o inline
      window.salvarEdicao = async function (id, campo, valor) {
        // Busca o update atual para manter os outros campos
        const box = document.querySelector(`.update-box[data-id='${id}']`);
        const titulo = box.querySelector('h3').innerText;
        const paragrafo = box.querySelector('p').innerText;
        const icone = box.querySelector('i').classList[1].replace('fa-', '');
        try {
          const res = await fetch(`${API_URL}/${id}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            credentials: 'include',
            body: JSON.stringify({ icone, titulo, paragrafo }),
          });
          const data = await res.json();
          if (!data.success) {
            alert(data.message || 'Erro ao editar t√≥pico.');
            carregarAtualizacoes();
          }
        } catch (err) {
          alert('Erro de conex√£o.');
        }
      };

      // Fun√ß√£o para buscar e renderizar as mensagens do formul√°rio de contato
      async function carregarMensagensContato() {
        const container = document.getElementById('mensagens-banco');
        container.innerHTML =
          '<p style="color:#146677;text-align:center;">Carregando mensagens...</p>';
        try {
          // Faz a requisi√ß√£o GET para o backend
          const res = await fetch('https://labem.onrender.com/api/contact');
          const data = await res.json();
          if (data.success && data.mensagens.length > 0) {
            // Renderiza cada mensagem com bot√£o de deletar
            container.innerHTML = data.mensagens
              .map(
                (msg) => `
              <div class="mensagem-item" data-id="${msg._id}">
                <div class="mensagem-dados">
                  <strong>Nome:</strong> ${msg.nome}<br>
                  <span class="mensagem-email">${msg.email}</span><br>
                  <span class="mensagem-assunto">Assunto: ${msg.assunto}</span>
                </div>
                <div class="mensagem-texto">
                  ${msg.mensagem}
                </div>
                <button class="btn btn-danger btn-sm btn-deletar-msg" title="Deletar mensagem">
                  <i class="fas fa-trash-alt"></i>
                </button>
              </div>
            `
              )
              .join('');

            // Adiciona evento de click para todos os bot√µes de deletar
            document.querySelectorAll('.btn-deletar-msg').forEach((btn) => {
              btn.addEventListener('click', async function () {
                const mensagemDiv = this.closest('.mensagem-item');
                const id = mensagemDiv.getAttribute('data-id');
                if (confirm('Tem certeza que deseja deletar esta mensagem?')) {
                  await deletarMensagemContato(id);
                }
              });
            });
          } else {
            container.innerHTML =
              '<p style="color:#146677;text-align:center;">Nenhuma mensagem encontrada.</p>';
          }
        } catch (err) {
          container.innerHTML =
            '<p style="color:red;text-align:center;">Erro ao carregar mensagens.</p>';
        }
      }

      // Fun√ß√£o para deletar uma mensagem de contato pelo ID
      async function deletarMensagemContato(id) {
        try {
          const res = await fetch(
            `https://labem.onrender.com/api/contact/${id}`,
            {
              method: 'DELETE',
            }
          );
          const data = await res.json();
          if (data.success) {
            carregarMensagensContato(); // Atualiza a lista
            alert('Mensagem deletada com sucesso!');
          } else {
            alert(data.message || 'Erro ao deletar mensagem.');
          }
        } catch (err) {
          alert('Erro de conex√£o ao deletar mensagem.');
        }
      }

      // Chama a fun√ß√£o ao carregar a p√°gina
      window.addEventListener('DOMContentLoaded', carregarMensagensContato);
    </script>
  </body>
</html>
